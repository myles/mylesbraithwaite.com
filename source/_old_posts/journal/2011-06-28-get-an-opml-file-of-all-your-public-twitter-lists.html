---
layout: post
category: journal
date: 2011-06-28 12:31:00
title: "Get an OPML File of All Your Public Twitter Lists"
author: myles
tags: [twitter, feed, python, programming]
---

<p>I made this simple python script today to get an OPML file (to be imported into Google Reader) of all my Twitter lists.</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;0.1&#39;</span>
<span class="n">__project_name__</span> <span class="o">=</span> <span class="s">&#39;TwitterListOPML&#39;</span>
<span class="n">__project_link__</span> <span class="o">=</span> <span class="s">&#39;https://gist.github.com/1051517&#39;</span>

<span class="n">TWITTER_LISTS_URL</span> <span class="o">=</span> <span class="s">&quot;http://api.twitter.com/1/</span><span class="si">%(username)s</span><span class="s">/lists.json&quot;</span>
<span class="n">TWITTER_LIST_FEED_URL</span> <span class="o">=</span> <span class="s">&quot;http://api.twitter.com/1/</span><span class="si">%(username)s</span><span class="s">/lists/</span><span class="si">%(list)s</span><span class="s">/statuses.atom&quot;</span>
<span class="n">TWITTER_LIST_HTML_URL</span> <span class="o">=</span> <span class="s">&quot;http://twitter.com/</span><span class="si">%(username)s</span><span class="s">/</span><span class="si">%(list)s</span><span class="s">&quot;</span>

<span class="n">OPML_START</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="s">&lt;!-- OPML generated by TwitterListOPML --&gt;</span>
<span class="s">&lt;opml version=&quot;1.1&quot;&gt;</span>
<span class="s">    &lt;head&gt;</span>
<span class="s">        &lt;title&gt;Twitter Lists&lt;/title&gt;</span>
<span class="s">    &lt;/head&gt;</span>
<span class="s">    &lt;body&gt;</span>
<span class="s">        &lt;outline text=&quot;Twitter Lists&quot; title=&quot;Twitter Lists&quot;&gt;&quot;&quot;&quot;</span>
<span class="n">OPML_END</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;      &lt;/outline&gt;</span>
<span class="s">    &lt;/body&gt;</span>
<span class="s">&lt;/opml&gt;&quot;&quot;&quot;</span>

<span class="n">OPML_OUTLINE_FEED</span> <span class="o">=</span> <span class="s">&#39;&lt;outline text=&quot;</span><span class="si">%(title)s</span><span class="s">&quot; title=&quot;</span><span class="si">%(title)s</span><span class="s">&quot; type=&quot;rss&quot; version=&quot;RSS&quot; htmlUrl=&quot;</span><span class="si">%(html_url)s</span><span class="s">&quot; xmlUrl=&quot;</span><span class="si">%(xml_url)s</span><span class="s">&quot; /&gt;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">urllib2</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">simplejson</span> <span class="kn">as</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">get_lists</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">__project_name__</span><span class="p">,</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">__project_link__</span>
    <span class="p">))</span>
    <span class="n">opener</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="n">t_lists</span> <span class="o">=</span> <span class="n">get_lists</span><span class="p">(</span><span class="n">TWITTER_LISTS_URL</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">})</span>

    <span class="k">print</span> <span class="n">OPML_START</span>

    <span class="k">for</span> <span class="n">t_list</span> <span class="ow">in</span> <span class="n">t_lists</span><span class="p">[</span><span class="s">&#39;lists&#39;</span><span class="p">]:</span>
        <span class="n">list_title</span> <span class="o">=</span> <span class="n">t_list</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">list_html_url</span> <span class="o">=</span> <span class="n">TWITTER_LIST_HTML_URL</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="s">&#39;list&#39;</span><span class="p">:</span> <span class="n">t_list</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]}</span>
        <span class="n">list_xml_url</span> <span class="o">=</span> <span class="n">TWITTER_LIST_FEED_URL</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="s">&#39;list&#39;</span><span class="p">:</span> <span class="n">t_list</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]}</span>
        <span class="k">print</span> <span class="n">OPML_OUTLINE_FEED</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">list_title</span><span class="p">,</span> <span class="s">&#39;html_url&#39;</span><span class="p">:</span> <span class="n">list_html_url</span><span class="p">,</span> <span class="s">&#39;xml_url&#39;</span><span class="p">:</span> <span class="n">list_xml_url</span><span class="p">}</span>

    <span class="k">print</span> <span class="n">OPML_END</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">main</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</pre></div>


<p>Download: <a href="http://cdn.mylesbraithwaite.com/media/uploads/journal/2011-06-28-get-an-opml-file-of-all-your-public-twitter-lists/twitter_list_to_opml.py.gz">twitter_list_to_opml.py.gz</a></p>
